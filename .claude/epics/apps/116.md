---
created: 2025-10-03T18:53:58Z
updated: 2025-10-03T19:15:13Z
status: open
task_id: 004
title: 开发工具配置调整
size: XS
estimation: 15分钟
parallel: true
depends_on: [115]
github: https://github.com/ycc-im/noteum/issues/116
---

# Task 004: 开发工具配置调整

## 概述

调整开发工具配置以适应新的目录结构，包括代码格式化、代码检查、IDE 配置等工具的路径过滤器和项目引用设置。

## 技术细节

### 需要调整的配置文件

#### 1. Prettier 配置
- `.prettierrc` 或 `prettier.config.js`
- `.prettierignore`

#### 2. ESLint 配置
- `.eslintrc.js` 或 `eslint.config.js`
- `.eslintignore`

#### 3. TypeScript 项目引用
- 根 `tsconfig.json`
- 解决方案级配置

#### 4. IDE 配置
- `.vscode/settings.json`
- `.vscode/extensions.json`
- `.idea/` 配置（如果使用 JetBrains IDE）

### 配置更新内容

#### Prettier 忽略模式更新
**当前可能的配置：**
```
packages/*/dist
packages/*/build
```

**目标配置：**
```
packages/*/dist
packages/*/build
apps/*/dist
apps/*/build
apps/*/src-tauri/target
```

#### ESLint 路径配置
**如果使用 workspace 配置：**
```javascript
module.exports = {
  root: true,
  ignorePatterns: [
    'packages/*/dist',
    'packages/*/build',
    'apps/*/dist',
    'apps/*/build',
    'apps/*/src-tauri/target'
  ]
}
```

#### TypeScript 项目引用
**根 tsconfig.json 中的 references：**
```json
{
  "references": [
    { "path": "./packages/shared" },
    { "path": "./packages/ui" },
    { "path": "./apps/web" },
    { "path": "./apps/desktop" },
    { "path": "./apps/server" }
  ]
}
```

#### VSCode 工作区配置
**如果存在 `.vscode/settings.json`：**
```json
{
  "typescript.preferences.includePackageJsonAutoImports": "on",
  "typescript.suggest.autoImports": true,
  "eslint.workingDirectories": ["packages/*", "apps/*"],
  "search.exclude": {
    "**/node_modules": true,
    "packages/*/dist": true,
    "packages/*/build": true,
    "apps/*/dist": true,
    "apps/*/build": true,
    "apps/*/src-tauri/target": true
  }
}
```

## 执行步骤

### 1. 检查现有配置
```bash
# 列出所有开发工具配置文件
find . -maxdepth 2 -name ".prettierrc*" -o -name "prettier.config.*"
find . -maxdepth 2 -name ".eslintrc*" -o -name "eslint.config.*"
find . -name ".vscode" -type d
find . -name ".idea" -type d
```

### 2. 更新忽略文件
- 在 `.prettierignore` 中添加 `apps/*/` 相关的忽略模式
- 在 `.eslintignore` 中添加 `apps/*/` 相关的忽略模式
- 更新任何其他工具的忽略配置

### 3. 调整 TypeScript 项目引用
- 更新根 `tsconfig.json` 的 `references` 数组
- 确保所有应用和包都包含在项目引用中
- 验证引用路径的正确性

### 4. 更新 IDE 配置
- 调整 VSCode 设置中的路径过滤器
- 更新搜索排除模式
- 配置 workspace 相关设置

## 验收标准

### 工具配置正确性
- [ ] Prettier 能够正确格式化 `apps/` 目录下的代码
- [ ] ESLint 能够正确检查 `apps/` 目录下的代码
- [ ] TypeScript 项目引用包含所有移动后的应用
- [ ] IDE 配置识别新的目录结构

### 忽略模式验证
- [ ] 构建产物目录被正确忽略
- [ ] node_modules 目录被正确忽略
- [ ] Tauri 的 target 目录被正确忽略
- [ ] 搜索和版本控制忽略配置正确

### IDE 功能验证
- [ ] 代码智能提示在所有应用中正常工作
- [ ] 跨包/应用的导航功能正常
- [ ] 重构操作能够跨目录执行
- [ ] 调试配置适应新结构

### 性能验证
- [ ] IDE 索引速度不受显著影响
- [ ] 搜索性能保持良好
- [ ] 代码分析工具运行效率正常

## 风险控制

### 配置备份
备份所有开发工具配置：
```bash
cp .prettierrc .prettierrc.backup 2>/dev/null || true
cp .eslintrc.js .eslintrc.js.backup 2>/dev/null || true
cp -r .vscode .vscode.backup 2>/dev/null || true
```

### 渐进式验证
每个配置修改后立即测试：
```bash
# 验证 Prettier
npx prettier --check "apps/**/*.{js,ts,tsx}"

# 验证 ESLint
npx eslint "apps/**/*.{js,ts,tsx}"

# 验证 TypeScript
npx tsc --noEmit
```

### 回滚策略
如果配置导致问题：
```bash
mv .prettierrc.backup .prettierrc 2>/dev/null || true
mv .eslintrc.js.backup .eslintrc.js 2>/dev/null || true
rm -rf .vscode && mv .vscode.backup .vscode 2>/dev/null || true
```

## 技术约束

### 工具版本兼容性
- ESLint >= 8.0（支持新配置格式）
- Prettier >= 2.0
- TypeScript >= 4.0（支持项目引用）

### 配置格式要求
- 保持现有配置格式（JSON/JS/YAML）
- 不改变核心规则，仅调整路径
- 确保与 CI/CD 环境兼容

### 性能考虑
- 避免过多的文件模式匹配
- 合理设置忽略模式减少扫描开销
- 保持 IDE 响应性能

## 完成定义

任务被认为完成当：

1. **工具配置更新完整**
   - 所有开发工具的路径配置包含 `apps/` 目录
   - 忽略模式正确配置
   - TypeScript 项目引用准确

2. **功能验证通过**
   - 代码格式化工具正常工作
   - 代码检查工具正常工作
   - IDE 智能功能正常工作

3. **性能维持良好**
   - 工具执行速度不受显著影响
   - IDE 响应性能良好
   - 搜索和索引效率正常

4. **开发体验优化**
   - 开发者工作流程顺畅
   - 错误提示和警告准确
   - 代码导航和重构功能完整

## 注意事项

- 此任务可以与验证任务（Task 005）并行执行
- 不影响应用程序的核心功能
- 主要影响开发体验和代码质量工具
- 建议在完成后重启 IDE 以确保配置生效
- 某些配置可能需要团队其他成员同步更新
