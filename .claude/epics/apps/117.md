# Task 005: 构建和开发命令验证

## Frontmatter
```yaml
created: 2025-10-03T18:53:58Z
updated: 2025-10-03T19:15:15Z
epic: apps
task_id: 005
title: 构建和开发命令验证
description: 验证所有构建和开发命令正常工作
priority: high
estimated_hours: 0.5
size: S
status: open
assignee: claude
parallel: true
depends_on: [115]
github: https://github.com/ycc-im/noteum/issues/117
```

## 概述

验证apps目录结构重构后，所有构建和开发命令能够正常工作，包括开发服务器、构建流程、测试执行和类型检查。

## 背景

apps目录重构完成后，需要确保所有的package.json脚本命令和构建工具配置都能正确识别新的目录结构，开发和部署流程不受影响。

## 验收标准

### 开发服务器验证
- [ ] `pnpm dev` 命令成功启动所有应用的开发服务器
- [ ] 所有应用能在指定端口正常访问
- [ ] 热重载功能在代码修改时正常工作
- [ ] 开发服务器无错误和警告信息

### 构建验证
- [ ] `pnpm build` 命令成功构建所有包和应用
- [ ] 构建产物输出到正确的目录
- [ ] 构建过程无错误和警告
- [ ] 构建产物文件完整且有效

### 测试验证
- [ ] `pnpm test` 命令成功运行所有测试套件
- [ ] 所有测试用例通过
- [ ] 测试覆盖率报告正常生成
- [ ] 测试运行时无错误和警告

### 类型检查验证
- [ ] `pnpm typecheck` 命令成功完成类型检查
- [ ] 所有TypeScript文件类型正确
- [ ] 类型检查无错误和警告
- [ ] 类型定义文件路径正确

### 热重载验证
- [ ] 修改应用代码时热重载正常触发
- [ ] 修改共享组件时相关应用自动更新
- [ ] 热重载速度在合理范围内
- [ ] 热重载不影响应用状态

## 技术细节

### 命令验证清单

1. **开发命令验证**
   ```bash
   # 启动所有应用开发服务器
   pnpm dev

   # 验证各应用访问地址
   # - Web应用: http://localhost:3000
   # - Electron应用: 应用窗口启动
   # - 移动应用: Metro服务器启动
   ```

2. **构建命令验证**
   ```bash
   # 构建所有包和应用
   pnpm build

   # 检查构建产物
   ls -la apps/*/dist/
   ls -la packages/*/dist/
   ```

3. **测试命令验证**
   ```bash
   # 运行所有测试
   pnpm test

   # 运行特定应用测试
   pnpm test --filter @noteum/web
   pnpm test --filter @noteum/electron
   ```

4. **类型检查验证**
   ```bash
   # 全局类型检查
   pnpm typecheck

   # 检查特定包类型
   pnpm typecheck --filter @noteum/*
   ```

### 验证重点

1. **路径解析**
   - 确认import路径正确解析到新的apps目录
   - 验证相对路径和绝对路径都正常工作
   - 检查模块解析配置是否需要更新

2. **配置文件**
   - 验证tsconfig.json的路径映射
   - 检查打包工具配置文件
   - 确认环境变量和配置正确加载

3. **依赖关系**
   - 验证应用间依赖正确解析
   - 检查共享包的引用路径
   - 确认工作空间配置正确

### 问题排查

如果命令执行失败，按以下步骤排查：

1. **检查package.json配置**
   - 验证scripts字段路径正确
   - 检查workspaces配置包含apps目录
   - 确认依赖版本兼容

2. **检查构建工具配置**
   - 更新Webpack/Vite配置中的路径
   - 检查TypeScript配置的paths映射
   - 验证ESLint和Prettier配置路径

3. **检查环境配置**
   - 验证环境变量文件路径
   - 检查配置文件加载逻辑
   - 确认开发和生产环境配置

## 定义完成

以下条件全部满足时任务完成：

1. ✅ 所有pnpm命令(dev/build/test/typecheck)执行成功
2. ✅ 开发服务器启动正常，应用可访问
3. ✅ 构建产物生成正确，无错误警告
4. ✅ 所有测试用例通过，覆盖率正常
5. ✅ 类型检查通过，无类型错误
6. ✅ 热重载功能工作正常
7. ✅ 性能指标在合理范围内
8. ✅ 开发体验无明显下降

## 风险和缓解

### 主要风险
- 路径配置错误导致命令失败
- 构建工具配置需要更新
- 依赖解析问题

### 缓解措施
- 逐个验证每个命令，发现问题立即修复
- 准备配置文件回滚方案
- 记录所有配置更改便于调试

## 后续任务

完成后将为006任务（文档更新和清理）提供验证基础，确保文档中的命令示例都是可工作的。
