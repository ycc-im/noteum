---
name: apps
status: backlog
created: 2025-10-03T18:49:27Z
progress: 0%
prd: .claude/prds/apps.md
github: https://github.com/ycc-im/noteum/issues/112
---

# Epic: Apps 架构重构

## 概述

将 noteum monorepo 从错误的 packages/ 架构重构为标准的 apps/ + packages/ 分离架构。这是一个文件结构重组操作，专注于最小化代码变更的同时确保架构清晰性和可维护性。

## 架构决策

### 目录结构重组
- **apps/**：独立部署的应用程序
  - `apps/web/` - React Web 前端应用
  - `apps/desktop/` - Tauri 桌面应用
  - `apps/server/` - 后端服务应用

- **packages/**：可复用的共享库
  - `packages/shared/` - 共享业务逻辑（保留）
  - `packages/ui/` - 共享 UI 组件库（保留）

### 技术策略
- **零停机重构**：通过 git mv 保持文件历史
- **工作区兼容性**：保持 pnpm workspace 功能
- **路径最小化**：仅更新必要的引用路径
- **向后兼容**：保持所有现有命令的功能

## 技术实现方案

### 文件移动策略
使用 `git mv` 命令确保：
- 保持 Git 历史记录完整
- 避免大量的 diff 噪音
- 支持快速回滚

### 配置更新模式
1. **根配置**：更新 workspace 路径模式
2. **应用配置**：更新跨包引用
3. **工具配置**：更新路径过滤器

### 验证机制
- 构建测试：所有包能正常构建
- 开发测试：dev 服务器正常启动
- 功能测试：现有功能保持完整

## 实施策略

### 分阶段执行
1. **准备阶段**：备份和依赖分析
2. **移动阶段**：快速批量文件移动
3. **配置阶段**：更新所有相关配置
4. **验证阶段**：全面功能测试

### 风险控制
- Git 分支保护，随时可回滚
- 分步验证，每步确认正常
- 配置备份，支持快速恢复

## 任务分解概览

任务设计遵循"最小变更"原则，将 10+ 个潜在任务合并为 6 个核心任务：

- [ ] **Task 1**: 目录结构创建和文件移动
- [ ] **Task 2**: 根配置更新（package.json, workspace）
- [ ] **Task 3**: 应用间依赖路径更新
- [ ] **Task 4**: 开发工具配置调整
- [ ] **Task 5**: 构建和开发命令验证
- [ ] **Task 6**: 文档更新和清理

## 依赖关系

### 技术依赖
- pnpm workspace 系统
- 现有的 TypeScript 配置
- 当前的构建流水线

### 团队依赖
- 开发团队同步更新（迁移完成后）
- 无外部系统依赖

### 顺序依赖
- 文件移动必须在配置更新之前
- 验证必须在每个阶段完成后进行

## 成功标准（技术）

### 功能完整性
- [ ] `pnpm dev` 启动所有应用（3个应用）
- [ ] `pnpm build` 构建成功（5个包）
- [ ] `pnpm test` 测试通过
- [ ] `pnpm typecheck` 类型检查通过

### 架构清晰度
- [ ] 应用程序 100% 位于 `apps/` 目录
- [ ] 共享库 100% 位于 `packages/` 目录
- [ ] 目录结构符合行业标准

### 开发体验
- [ ] 所有现有命令功能不变
- [ ] 热重载正常工作
- [ ] IDE 类型推导正常

## 预估工作量

- **总体时间**：2-4 小时
- **风险级别**：低（纯结构重组）
- **关键路径**：配置更新和验证

### 详细估算
- Task 1 (文件移动)：30分钟
- Task 2-3 (配置更新)：60分钟
- Task 4-5 (工具和验证)：30分钟
- Task 6 (文档清理)：15分钟
- 缓冲时间：45分钟

## 任务已创建
- [ ] #113 - 目录结构创建和文件移动 (parallel: false)
- [ ] #114 - 根配置更新 (parallel: false)
- [ ] #115 - 应用间依赖路径更新 (parallel: false)
- [ ] #116 - 开发工具配置调整 (parallel: true)
- [ ] #117 - 构建和开发命令验证 (parallel: true)
- [ ] #118 - 文档更新和清理 (parallel: true)

总任务数：       6
并行任务：       3
顺序任务：3
## 质量保证

### 自动化验证
- 构建成功率：100%
- 测试通过率：100%
- 类型检查：零错误

### 手动验证
- 应用启动正常
- 功能完整性检查
- 开发体验验证
