---
name: Markdownæ¸²æŸ“ï¼šä¾èµ–å®‰è£…å’ŒåŸºç¡€æ¸²æŸ“åŠŸèƒ½ï¼ˆTDDï¼‰
status: open
created: 2025-10-07T00:00:00Z
github: https://github.com/ycc-im/noteum/issues/129
depends_on: [008]
parallel: true
conflicts_with: []
---

# Task: Markdownæ¸²æŸ“ï¼šä¾èµ–å®‰è£…å’ŒåŸºç¡€æ¸²æŸ“åŠŸèƒ½ï¼ˆTDDï¼‰

## Description

**é‡‡ç”¨TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰æ–¹æ³•**æ·»åŠ Markdownæ¸²æŸ“æ‰€éœ€çš„npmä¾èµ–åŒ…ï¼Œé…ç½®åŸºç¡€Markdownæ¸²æŸ“åŠŸèƒ½ï¼Œæ”¯æŒä»£ç é«˜äº®ã€GFMï¼ˆGitHub Flavored Markdownï¼‰å’Œè¡¨æ ¼ç­‰å¸¸ç”¨åŠŸèƒ½ï¼Œä¸ºç¬”è®°ç³»ç»Ÿæä¾›å†…å®¹å±•ç¤ºèƒ½åŠ›ã€‚

**TDDå¼€å‘æµç¨‹**ï¼šä¸¥æ ¼éµå¾ªRed-Green-Refactorå¾ªç¯ï¼Œå…ˆä¸ºæ¯ä¸ªMarkdownåŠŸèƒ½ç¼–å†™å¤±è´¥çš„æµ‹è¯•ï¼Œå†å®ç°åŠŸèƒ½ï¼Œæœ€åä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

## Acceptance Criteria

### ğŸ”´ TDDé˜¶æ®µï¼šæµ‹è¯•å…ˆè¡Œï¼ˆRedï¼‰
- [ ] **ç¼–å†™Markdownæ¸²æŸ“æµ‹è¯•å¥—ä»¶**ï¼šå…ˆä¸ºæ‰€æœ‰MarkdownåŠŸèƒ½ç¼–å†™å¤±è´¥çš„æµ‹è¯•
- [ ] **åŸºç¡€è¯­æ³•æµ‹è¯•**ï¼šæ ‡é¢˜ã€åˆ—è¡¨ã€é“¾æ¥ã€å›¾ç‰‡ã€ä»£ç å—ç­‰åŸºç¡€Markdownè¯­æ³•æµ‹è¯•
- [ ] **GFMæ‰©å±•æµ‹è¯•**ï¼šè¡¨æ ¼ã€ä»»åŠ¡åˆ—è¡¨ã€åˆ é™¤çº¿ç­‰GitHub Flavored MarkdownåŠŸèƒ½æµ‹è¯•
- [ ] **ä»£ç é«˜äº®æµ‹è¯•**ï¼šå¤šè¯­è¨€è¯­æ³•é«˜äº®ã€è¡Œå·æ˜¾ç¤ºã€å¤åˆ¶åŠŸèƒ½ç­‰æµ‹è¯•
- [ ] **æ€§èƒ½æµ‹è¯•**ï¼šå¤§æ–‡æ¡£æ¸²æŸ“æ€§èƒ½ã€å†…å­˜ä½¿ç”¨ç­‰åŸºå‡†æµ‹è¯•
- [ ] **ç»„ä»¶é›†æˆæµ‹è¯•**ï¼šMarkdownRendererç»„ä»¶ä¸ç°æœ‰UIç³»ç»Ÿçš„é›†æˆæµ‹è¯•

### ğŸŸ¢ å®ç°é˜¶æ®µï¼šåŠŸèƒ½å®ç°ï¼ˆGreenï¼‰
- [ ] å®‰è£…react-markdownåŠç›¸å…³ä¾èµ–åŒ…
- [ ] é…ç½®remark-gfmæ”¯æŒGitHub Flavored Markdown
- [ ] é›†æˆreact-syntax-highlighterå®ç°ä»£ç è¯­æ³•é«˜äº®
- [ ] åˆ›å»ºåŸºç¡€çš„MarkdownRendererç»„ä»¶ï¼Œè®©TDDæµ‹è¯•é€šè¿‡
- [ ] æ”¯æŒå¸¸ç”¨Markdownè¯­æ³•ï¼ˆæ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å—ã€é“¾æ¥ã€å›¾ç‰‡ï¼‰
- [ ] å®ç°ä»£ç ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
- [ ] æ·»åŠ è‡ªå®šä¹‰Markdownæ ·å¼ï¼Œç¬¦åˆç°æœ‰è®¾è®¡ç³»ç»Ÿ

### ğŸ”„ é‡æ„é˜¶æ®µï¼šä»£ç ä¼˜åŒ–ï¼ˆRefactorï¼‰
- [ ] **ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½**ï¼šåœ¨ä¿æŒæµ‹è¯•é€šè¿‡çš„å‰æä¸‹ä¼˜åŒ–å¤§æ–‡æ¡£æ¸²æŸ“
- [ ] **ç»„ä»¶é‡æ„**ï¼šæå‡MarkdownRendererç»„ä»¶çš„å¯å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§
- [ ] **æ ·å¼ä¼˜åŒ–**ï¼šä¼˜åŒ–CSSæ€§èƒ½ï¼Œå‡å°‘é‡å¤ä»£ç 
- [ ] **TDDè´¨é‡éªŒè¯**ï¼šç¡®ä¿æµ‹è¯•è¦†ç›–ç‡â‰¥90%ï¼Œæ‰€æœ‰æµ‹è¯•ç¨³å®šé€šè¿‡

## Technical Details

### TDDæµ‹è¯•è®¾è®¡

#### MarkdownåŸºç¡€åŠŸèƒ½æµ‹è¯•
```typescript
// src/components/markdown/MarkdownRenderer.test.tsx
describe('MarkdownRenderer TDD', () => {
  describe('Basic Markdown Syntax', () => {
    it('should render headers correctly', () => {
      const content = '# H1 Header\n## H2 Header\n### H3 Header';

      const { getByRole } = render(
        <MarkdownRenderer content={content} />
      );

      expect(getByRole('heading', { level: 1 })).toHaveTextContent('H1 Header');
      expect(getByRole('heading', { level: 2 })).toHaveTextContent('H2 Header');
      expect(getByRole('heading', { level: 3 })).toHaveTextContent('H3 Header');
    });

    it('should render lists correctly', () => {
      const content = `- Item 1\n- Item 2\n  - Nested item`;

      const { getByRole } = render(
        <MarkdownRenderer content={content} />
      );

      expect(getByRole('list')).toBeInTheDocument();
      expect(getByRole('listitem')).toBeInTheDocument();
    });

    it('should render code blocks with syntax highlighting', () => {
      const content = '```javascript\nconst x = 1;\n```';

      const { getByText } = render(
        <MarkdownRenderer content={content} codeTheme="dark" />
      );

      expect(getByText('const x = 1;')).toBeInTheDocument();
      // éªŒè¯è¯­æ³•é«˜äº®CSSç±»è¢«åº”ç”¨
      expect(getByText('const x = 1;')).toHaveClass('token-keyword');
    });

    it('should render links correctly', () => {
      const content = '[Link Text](https://example.com)';

      const { getByRole } = render(
        <MarkdownRenderer content={content} />
      );

      const link = getByRole('link');
      expect(link).toHaveTextContent('Link Text');
      expect(link).toHaveAttribute('href', 'https://example.com');
    });
  });

  describe('GFM Extensions', () => {
    it('should render tables correctly', () => {
      const content = `
| Header 1 | Header 2 |
|----------|----------|
| Cell 1   | Cell 2   |
| Cell 3   | Cell 4   |
      `.trim();

      const { getByRole } = render(
        <MarkdownRenderer content={content} enableGFM={true} />
      );

      expect(getByRole('table')).toBeInTheDocument();
      expect(getByRole('columnheader', { name: 'Header 1' })).toBeInTheDocument();
    });

    it('should render task lists correctly', () => {
      const content = '- [x] Completed task\n- [ ] Incomplete task';

      const { getAllByRole } = render(
        <MarkdownRenderer content={content} enableGFM={true} />
      );

      const checkboxes = getAllByRole('checkbox');
      expect(checkboxes).toHaveLength(2);
      expect(checkboxes[0]).toBeChecked();
      expect(checkboxes[1]).not.toBeChecked();
    });

    it('should render strikethrough text correctly', () => {
      const content = '~~Strikethrough text~~';

      const { getByText } = render(
        <MarkdownRenderer content={content} enableGFM={true} />
      );

      expect(getByText('Strikethrough text')).toHaveStyle('text-decoration: line-through');
    });
  });

  describe('Code Block Features', () => {
    it('should show line numbers when enabled', () => {
      const content = '```javascript\nline 1\nline 2\nline 3\n```';

      const { getByText } = render(
        <MarkdownRenderer content={content} showLineNumbers={true} />
      );

      expect(getByText('1')).toBeInTheDocument();
      expect(getByText('2')).toBeInTheDocument();
      expect(getByText('3')).toBeInTheDocument();
    });

    it('should support code copy functionality', async () => {
      const content = '```javascript\nconst code = "test";\n```';
      const user = userEvent.setup();

      const { getByRole } = render(
        <MarkdownRenderer content={content} enableCopy={true} />
      );

      const copyButton = getByRole('button', { name: /copy/i });
      await user.click(copyButton);

      // éªŒè¯å¤åˆ¶åŠŸèƒ½
      expect(navigator.clipboard.writeText).toHaveBeenCalledWith('const code = "test";');
    });
  });

  describe('Theme Support', () => {
    it('should apply dark theme correctly', () => {
      const content = '```javascript\nconst x = 1;\n```';

      const { container } = render(
        <MarkdownRenderer content={content} codeTheme="dark" />
      );

      expect(container.querySelector('.dark-theme')).toBeInTheDocument();
    });

    it('should apply light theme correctly', () => {
      const content = '```javascript\nconst x = 1;\n```';

      const { container } = render(
        <MarkdownRenderer content={content} codeTheme="light" />
      );

      expect(container.querySelector('.light-theme')).toBeInTheDocument();
    });
  });
});
```

#### æ€§èƒ½æµ‹è¯•
```typescript
// src/test/performance/markdown.test.tsx
describe('MarkdownRenderer Performance TDD', () => {
  it('should render large document within performance threshold', async () => {
    const largeContent = generateLargeMarkdownDocument(10000); // 10kå­—ç¬¦

    const startTime = performance.now();

    const { container } = render(
      <MarkdownRenderer content={largeContent} />
    );

    const endTime = performance.now();

    expect(endTime - startTime).toBeLessThan(500); // 500mså†…å®Œæˆ
    expect(container.firstChild).toBeInTheDocument();
  });

  it('should handle code block rendering efficiently', async () => {
    const contentWithMultipleCodeBlocks = generateDocumentWithCodeBlocks(50);

    const startTime = performance.now();

    render(
      <MarkdownRenderer content={contentWithMultipleCodeBlocks} />
    );

    const endTime = performance.now();

    expect(endTime - startTime).toBeLessThan(1000); // 1ç§’å†…å®Œæˆ
  });
});
```

#### ç»„ä»¶é›†æˆæµ‹è¯•
```typescript
// src/components/markdown/integration.test.tsx
describe('MarkdownRenderer Integration TDD', () => {
  it('should integrate with existing design system', () => {
    const content = '# Test\nThis is a test content.';

    const { container } = render(
      <ThemeProvider theme="dark">
        <MarkdownRenderer content={content} />
      </ThemeProvider>
    );

    // éªŒè¯æ ·å¼ä¸»é¢˜æ­£ç¡®åº”ç”¨
    expect(container.querySelector('[data-theme="dark"]')).toBeInTheDocument();
  });

  it('should work within modal dialogs', () => {
    const content = 'Modal content with **bold** text.';

    const { getByText } = render(
      <Modal open>
        <MarkdownRenderer content={content} />
      </Modal>
    );

    expect(getByText('bold')).toHaveStyle('font-weight: bold');
  });
});
```

### ç»„ä»¶æ¶æ„è®¾è®¡

#### MarkdownRendereræ¥å£
```typescript
interface MarkdownRendererProps {
  content: string;
  className?: string;
  codeTheme?: 'dark' | 'light';
  enableGFM?: boolean;
  showLineNumbers?: boolean;
  enableCopy?: boolean;
  customComponents?: Record<string, React.ComponentType>;
  onLinkClick?: (url: string) => void;
}
```

#### CodeBlockç»„ä»¶æ¥å£
```typescript
interface CodeBlockProps {
  language?: string;
  children: string;
  theme?: 'dark' | 'light';
  showLineNumbers?: boolean;
  enableCopy?: boolean;
}
```

### TDDå®ç°è¦ç‚¹

#### Redé˜¶æ®µï¼šå¤±è´¥çš„æµ‹è¯•
- **åŸºç¡€è¯­æ³•æµ‹è¯•**ï¼šæ ‡é¢˜ã€åˆ—è¡¨ã€é“¾æ¥ã€å›¾ç‰‡ç­‰å…ƒç´ æ­£ç¡®æ¸²æŸ“
- **GFMæ‰©å±•æµ‹è¯•**ï¼šè¡¨æ ¼ã€ä»»åŠ¡åˆ—è¡¨ã€åˆ é™¤çº¿ç­‰é«˜çº§åŠŸèƒ½
- **ä»£ç é«˜äº®æµ‹è¯•**ï¼šè¯­æ³•é«˜äº®ã€è¡Œå·ã€å¤åˆ¶åŠŸèƒ½
- **æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼šå¤§æ–‡æ¡£æ¸²æŸ“æ—¶é—´ã€å†…å­˜ä½¿ç”¨
- **é›†æˆæµ‹è¯•**ï¼šä¸ç°æœ‰UIç»„ä»¶çš„å…¼å®¹æ€§

#### Greené˜¶æ®µï¼šæœ€å°å®ç°
- **ä¾èµ–å®‰è£…**ï¼šreact-markdownã€remark-gfmã€react-syntax-highlighter
- **åŸºç¡€ç»„ä»¶**ï¼šå®ç°æœ€ç®€åŠŸèƒ½è®©æµ‹è¯•é€šè¿‡
- **æ ·å¼é›†æˆ**ï¼šä¸shadcn/uiè®¾è®¡ç³»ç»Ÿä¿æŒä¸€è‡´
- **é”™è¯¯å¤„ç†**ï¼šå¤„ç†æ— æ•ˆMarkdownå’Œæ¸²æŸ“é”™è¯¯

#### Refactoré˜¶æ®µï¼šä¼˜åŒ–æå‡
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè™šæ‹ŸåŒ–ã€æ‡’åŠ è½½ã€ç¼“å­˜æœºåˆ¶
- **ç”¨æˆ·ä½“éªŒ**ï¼šåŠ è½½çŠ¶æ€ã€é”™è¯¯æç¤ºã€ä¸»é¢˜åˆ‡æ¢
- **ä»£ç è´¨é‡**ï¼šç»„ä»¶æ‹†åˆ†ã€å¤ç”¨æ€§ã€å¯æµ‹è¯•æ€§

### ä¾èµ–åŒ…é€‰æ‹©

```json
{
  "dependencies": {
    "react-markdown": "^9.0.1",
    "remark-gfm": "^4.0.0",
    "react-syntax-highlighter": "^15.5.0"
  }
}
```

### ä»£ç æ–‡ä»¶å½±å“

#### TDDæµ‹è¯•æ–‡ä»¶ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
- `src/components/markdown/MarkdownRenderer.test.tsx` - ä¸»ç»„ä»¶æµ‹è¯•
- `src/components/markdown/CodeBlock.test.tsx` - ä»£ç å—ç»„ä»¶æµ‹è¯•
- `src/test/performance/markdown.test.tsx` - æ€§èƒ½åŸºå‡†æµ‹è¯•
- `src/components/markdown/integration.test.tsx` - é›†æˆæµ‹è¯•

#### æ ¸å¿ƒå®ç°æ–‡ä»¶
- `src/components/markdown/MarkdownRenderer.tsx` - ä¸»æ¸²æŸ“ç»„ä»¶
- `src/components/markdown/CodeBlock.tsx` - ä»£ç å—ç»„ä»¶
- `src/components/markdown/styles/` - Markdownä¸“ç”¨æ ·å¼æ–‡ä»¶
- `src/hooks/useMarkdown.ts` - Markdownç›¸å…³hooks
- `src/utils/markdown.ts` - Markdownå·¥å…·å‡½æ•°

## Dependencies

- [ ] **ä»»åŠ¡008ï¼šTDDåŸºç¡€è®¾æ–½**å®Œæˆï¼Œæµ‹è¯•æ¡†æ¶å°±ä½
- [ ] React 19ç¯å¢ƒæ­£å¸¸
- [ ] Tailwind CSSé…ç½®å®Œæ•´
- [ ] ç°æœ‰ç»„ä»¶åº“shadcn/uiå¯ç”¨

## Effort Estimate

- Size: M
- Days: 2å¤©
- Parallel: true

### å·¥ä½œé‡åˆ†è§£
- **TDDæµ‹è¯•ç¼–å†™**ï¼š1å¤©ï¼ˆç¼–å†™æ‰€æœ‰åŠŸèƒ½çš„å¤±è´¥æµ‹è¯•ï¼‰
- **åŠŸèƒ½å®ç°**ï¼š0.5å¤©ï¼ˆå®‰è£…ä¾èµ–ï¼Œå®ç°åŸºç¡€åŠŸèƒ½ï¼‰
- **é‡æ„ä¼˜åŒ–**ï¼š0.5å¤©ï¼ˆæ€§èƒ½ä¼˜åŒ–å’Œä»£ç è´¨é‡æå‡ï¼‰

## Definition of Done

- [ ] **TDDæµç¨‹å®Œæ•´**ï¼šRed-Green-Refactorå¾ªç¯å®Œæ•´æ‰§è¡Œ
- [ ] **ä¾èµ–å®‰è£…å®Œæˆ**ï¼šæ‰€æœ‰Markdownç›¸å…³ä¾èµ–å®‰è£…æˆåŠŸï¼Œæ— ç‰ˆæœ¬å†²çª
- [ ] **åŠŸèƒ½å®Œæ•´**ï¼šåŸºç¡€Markdownã€GFMã€ä»£ç é«˜äº®åŠŸèƒ½å…¨éƒ¨å®ç°
- [ ] **æµ‹è¯•è¦†ç›–ç‡**ï¼šæ ¸å¿ƒåŠŸèƒ½å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥90%
- [ ] **æ€§èƒ½è¾¾æ ‡**ï¼šå¤§æ–‡æ¡£æ¸²æŸ“æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] **é›†æˆæ— é—®é¢˜**ï¼šä¸ç°æœ‰UIç³»ç»Ÿå®Œç¾é›†æˆ
- [ ] **ä»£ç è´¨é‡**ï¼šé€šè¿‡æ‰€æœ‰lintingå’Œç±»å‹æ£€æŸ¥
- [ ] **ç”¨æˆ·ä½“éªŒ**ï¼šä¸»é¢˜åˆ‡æ¢ã€ä»£ç å¤åˆ¶ç­‰åŠŸèƒ½æµç•…å¯ç”¨