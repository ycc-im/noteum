---
name: apps
description: 重构 monorepo 架构，将应用程序从 packages/ 移动到 apps/ 目录，符合最佳实践
status: backlog
created: 2025-10-03T18:22:23Z
---

# PRD: Apps 架构重构

## 执行摘要

将 noteum monorepo 的架构重构，从错误的 packages/ 结构迁移到正确的 apps/ + packages/ 分离架构。这将提高项目的可维护性、可扩展性，并符合 monorepo 行业最佳实践。

## 问题陈述

### 当前问题
- **架构混乱**: 将独立的应用程序（web、tauri、server）错误地放置在 `packages/` 目录下
- **概念混淆**: packages 应该是可复用的库，而不是独立部署的应用程序
- **扩展困难**: 添加新应用时缺乏清晰的组织原则
- **违反标准**: 不符合 monorepo 社区的最佳实践

### 为什么现在重要
- 项目正在成长，需要清晰的架构边界
- 未来可能添加移动端应用
- 团队需要一致的代码组织理解
- 符合行业标准有利于新开发者快速上手

## 用户故事

### 开发者（主要用户）
**作为一个开发者，我希望：**
- 能够清晰地区分应用程序和共享库
- 快速理解项目结构和各部分的职责
- 轻松添加新的应用程序
- 遵循业界标准的 monorepo 组织方式

**验收标准：**
- 目录结构直观反映代码的用途
- 构建命令保持一致的用户体验
- 所有现有功能正常工作

### 项目维护者
**作为项目维护者，我希望：**
- 新贡献者能快速理解项目架构
- 部署和CI/CD配置更加清晰
- 未来架构决策有清晰的指导原则

## 需求

### 功能需求

#### 核心架构调整
1. **创建 apps/ 目录结构**
   - `apps/web/` - Web 前端应用
   - `apps/desktop/` - Tauri 桌面应用
   - `apps/server/` - 后端服务应用

2. **迁移现有应用**
   - 移动 `packages/web` → `apps/web`
   - 移动 `packages/tauri` → `apps/desktop`
   - 移动 `packages/server` → `apps/server`

3. **保留真正的 packages**
   - `packages/shared` - 共享业务逻辑
   - `packages/ui` - 共享 UI 组件库

#### 配置更新
1. **根级配置文件**
   - 更新 `package.json` 中的 workspace 配置
   - 更新所有构建脚本路径
   - 调整开发命令结构

2. **应用级配置**
   - 更新各应用的依赖引用路径
   - 调整 TypeScript 配置
   - 更新构建输出路径

3. **工具配置**
   - 更新 prettier/eslint 配置路径
   - 调整 IDE 工作区配置
   - 更新 git 相关配置

### 非功能需求

#### 性能要求
- 构建时间不应显著增加
- 开发服务器启动时间保持一致
- 热重载功能正常工作

#### 兼容性要求
- 所有现有的 npm scripts 保持相同的功能
- 开发者工作流程保持一致
- 现有的 CI/CD 流水线最小改动

#### 安全要求
- 不暴露内部包的实现细节
- 保持现有的权限和访问控制

## 成功标准

### 主要指标
1. **架构清晰度**
   - 100% 的应用程序位于 `apps/` 目录
   - 100% 的共享库位于 `packages/` 目录
   - 目录结构符合行业标准

2. **功能完整性**
   - 所有现有命令正常工作
   - 所有应用程序能够成功构建和运行
   - 所有测试通过

3. **开发体验**
   - 新开发者能在 5 分钟内理解项目结构
   - 现有开发工作流程无需更改
   - 文档更新完整准确

### 验证方式
- [ ] `pnpm dev` 启动所有应用
- [ ] `pnpm build` 构建所有应用
- [ ] `pnpm test` 运行所有测试
- [ ] 所有 TypeScript 类型检查通过
- [ ] 热重载功能正常
- [ ] 代码 linting 正常

## 约束和假设

### 技术约束
- 必须保持 pnpm workspace 兼容性
- 不能破坏现有的构建流程
- TypeScript 配置必须正确解析路径

### 资源约束
- 必须在一次性操作中完成，避免长期的过渡状态
- 不能影响正在进行的功能开发

### 时间约束
- 重构应该在一个开发周期内完成
- 不能影响现有的发布计划

## 范围外

明确不包含在此次重构中的内容：

- **代码逻辑修改**: 不修改任何业务逻辑
- **新功能开发**: 不添加新的功能特性
- **性能优化**: 不进行构建性能优化（除非必要）
- **依赖升级**: 不升级第三方依赖版本
- **CI/CD 重构**: 只进行必要的路径调整，不重构整个流水线

## 依赖关系

### 外部依赖
- 无外部系统依赖

### 内部依赖
- 需要团队所有开发者同步更新本地环境
- 需要与 DevOps 团队协调 CI/CD 配置更新

### 阻塞因素
- 正在进行的功能分支可能需要同步更新
- 部署环境的配置文件可能需要调整

## 实施计划

### 第一阶段：准备工作
1. 备份当前配置
2. 分析所有依赖关系
3. 准备迁移脚本

### 第二阶段：目录重构
1. 创建新的目录结构
2. 移动应用程序文件
3. 更新所有引用路径

### 第三阶段：配置更新
1. 更新 package.json 和 workspace 配置
2. 调整构建脚本
3. 更新 TypeScript 配置

### 第四阶段：验证测试
1. 运行所有构建和测试
2. 验证开发工作流程
3. 更新相关文档

## 风险缓解

### 高风险项
- **构建失败**: 通过充分测试和回滚计划缓解
- **开发环境不一致**: 提供清晰的迁移指南

### 回滚计划
- 保持 git 历史完整，可以快速回滚
- 准备脚本自动恢复原有结构

## 后续步骤

重构完成后的改进机会：
1. 优化构建性能
2. 完善开发工具链
3. 建立架构治理规范
4. 为未来的微服务架构做准备